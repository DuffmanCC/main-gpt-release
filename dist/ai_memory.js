import{d as W,r as n,o,c as _,a as e,b as P,w as U,e as q,t as z,F as G,f as K,g as ge,v as he,h as O,n as H,i as se,j as oe,k as T,l as le,m as J,u as _e,p as xe,q as be,s as $e}from"./wug-style.js";import{m as ue,_ as re}from"./metabox-body.js";import{a as ke,_ as de,b as we,c as pe}from"./a-text.vue_vue_type_script_setup_true_lang.js";import{_ as ae,a as te}from"./a-select.vue_vue_type_script_setup_true_lang.js";import{p as Pe}from"./constants.js";import{c as Ce,u as Ie,g as ie,t as Me,e as Te,a as Se}from"./requests.js";import{a as I,e as Y}from"./tools.js";const De={class:"tw-flex tw-gap-6 tw-items-center"},Ae=["name","value","aria-describedby","disabled"],Oe=["id","innerHTML"],Ue=W({__name:"a-radio-button",props:{options:{type:Array,default:()=>[{label:"",value:""}],required:!0},selectedOption:{type:[String,Number],default:"",required:!0},label:{type:String,default:""},classes:{type:String,default:""},help:{type:String,default:""},id:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["select-option"],setup(m,{emit:k}){const y=m,C=k,r=n(y.selectedOption);function u(x){const i=x.target.value;r.value=i,C("select-option",i)}const c=`tw-flex tw-flex-col tw-gap-2 ${y.classes}`;return(x,v)=>(o(),_("fieldset",{class:H([c,"disabled:tw-cursor-not-allowed"])},[e("legend",null,[P(ke,null,{default:U(()=>[q(z(m.label),1)]),_:1})]),e("div",De,[(o(!0),_(G,null,K(m.options,i=>(o(),_("label",{key:i.value,class:"tw-flex tw-items-center tw-gap-2"},[ge(e("input",{type:"radio",name:m.id,value:i.value,"onUpdate:modelValue":v[0]||(v[0]=p=>r.value=p),onChange:v[1]||(v[1]=p=>u(p)),"aria-describedby":`${m.id}_help`,disabled:m.disabled,class:"tw-top-0.5 tw-relative"},null,40,Ae),[[he,r.value]]),q(" "+z(i.label),1)]))),128))]),m.help?(o(),_("div",{key:0,id:`${m.id}_help`,class:"tw-font-light tw-text-brand-gray-dark tw-text-sm tw-max-w-xl",innerHTML:m.help},null,8,Oe)):O("",!0)]))}}),je={class:"tw-flex tw-flex-col tw-gap-2"},Ve={class:"tw-flex tw-gap-8 tw-items-start tw-mb-4"},Re={class:"tw-flex tw-flex-col tw-gap-4 tw-w-1/4"},Ee=e("p",{class:"tw-font-light tw-text-brand-gray-dark tw-text-sm tw-max-w-xl"},[q(" More info "),e("a",{href:"https://www.pinecone.io/learn/vector-similarity/",class:"tw-text-blue-500 hover:tw-text-blue-700 tw-underline",target:"_blank"},"Vector Similarity Explained")],-1),Ne=W({__name:"ai-memory-create",emits:["createPineconIndexSuccess","createPineconIndexError"],setup(m,{emit:k}){const y=se("aiMemoryData");if(!y)throw new Error("aiMemoryData is undefined");const{ajaxActionConnectOrCreateIndex:C,ajaxUrl:r,nonceConnectOrCreateIndex:u,postId:c,aiMemory:x}=y,v=k,i=n([]),p=n(""),S=n(x.metric),M=async()=>{try{const b=await Ce(r,C,u,p.value,JSON.stringify(j.value),c);v("createPineconIndexSuccess",b.indexName),I(i,"success",`${b.message}: ${b.indexName}`)}catch(b){const f=Y(b);I(i,"error",f,0),v("createPineconIndexError","error")}finally{p.value=""}},j=oe(()=>({metric:S.value})),V=oe(()=>Pe.map(b=>({value:b,label:b})));function B(b){i.value=i.value.filter(f=>f.id!==b)}return(b,f)=>(o(),T(ue,null,{default:U(()=>[P(we,{class:"tw-top-2"},{default:U(()=>[(o(!0),_(G,null,K(i.value,g=>(o(),T(de,{key:g.id,type:g.type,message:g.message,time:g.time,onClose:Q=>B(g.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),e("div",je,[e("div",Ve,[P(pe,{id:"index_name",label:"Index name",help:"Index name must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character.",modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=g=>p.value=g),value:p.value,onEnter:M,onInput:f[1]||(f[1]=g=>p.value=g)},null,8,["modelValue","value"]),P(ae,{onClick:M,disabled:!p.value,class:"tw-relative tw-top-8"},{default:U(()=>[q("Create")]),_:1},8,["disabled"])]),e("div",Re,[P(Ue,{id:"metric",label:"Metric",options:V.value,selectedOption:S.value,onSelectOption:f[2]||(f[2]=g=>S.value=g),help:"The distance metric to be used for similarity search. You can use 'euclidean', 'cosine', or 'dotproduct'."},null,8,["options","selectedOption"]),Ee])])]),_:1}))}}),ze={class:"tw-inline-flex tw-items-center tw-justify-center tw-overflow-hidden tw-rounded-full"},Be={class:"tw-w-20 tw-h-20"},Le=e("circle",{class:"tw-text-gray-200","stroke-width":"5",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,-1),Fe=["stroke-dashoffset"],He={class:"tw-absolute tw-text-xs tw-text-blue-700"},ce=W({__name:"a-progress",props:{percent:{type:Number,default:50}},setup(m){const k=2*Math.PI*30;return(y,C)=>(o(),_("div",ze,[(o(),_("svg",Be,[Le,e("circle",{class:"tw-text-blue-500","stroke-width":"5","stroke-dasharray":k,"stroke-dashoffset":k-m.percent/100*k,"stroke-linecap":"round",stroke:"currentColor",fill:"transparent",r:"30",cx:"40",cy:"40"},null,8,Fe)])),e("span",He,z(m.percent)+"%",1)]))}}),qe={class:"tw-flex tw-flex-col tw-gap-4 tw-w-full"},We={class:""},Ye={class:"tw-flex tw-gap-4"},Je={class:"tw-w-1/2"},Ge={class:"tw-flex tw-flex-col gap-2 tw-w-full"},Ke={class:"tw-w-1/2 tw-flex tw-gap-2"},Qe={class:"tw-flex tw-gap-4"},Xe={class:"tw-w-1/2 tw-rounded-md tw-h-72 tw-overflow-y-auto tw-border tw-border-gray-300 tw-shadow"},Ze={id:"select-posts"},et={class:"tw-px-2 tw-py-1 tw-font-bold"},tt=["onClick","innerHTML"],at={class:"tw-w-1/2 tw-rounded-md tw-h-72 tw-overflow-y-auto tw-border tw-border-gray-300 tw-shadow"},st={id:"selected-posts"},nt=["innerHTML"],ot=["onClick"],lt=e("div",{class:"tw-relative tw-w-8 tw-bottom-0.5"},"-",-1),rt=[lt],it=W({__name:"a-relationship",props:{selectedPostsDefault:{type:Array,default:()=>[]},restUrl:String},emits:["add-post","remove-post"],setup(m,{emit:k}){const y=m,C=k,r=n(""),u=n("posts"),c=n(""),x=n(""),v=n([]),i=n(y.selectedPostsDefault),p=n(1),S=n([]),M=n([]),j=n(!1),V=n(null),B=[{value:"posts",label:"Posts"},{value:"pages",label:"Pages"},{value:"product",label:"Products"}];function b(t){g(t)||(i.value=[t,...i.value],C("add-post",t))}function f(t){i.value=i.value.filter(l=>l.id!==t.id),C("remove-post",{id:t.id})}function g(t){return i.value.find(l=>l.id===t.id)}function Q(t){return t==="product"?"Products":t==="pages"?"Pages":"Posts"}function Z(t){return t==="product"?"product":t==="pages"?"page":"post"}async function $({type:t="posts",perPage:l=10,page:a=1,taxonomy:d="",term:h="",search:L=""}){j.value=!0;let F=`${y.restUrl}${t}?page=${a}&per_page=${l}&search=${L}`;d&&h&&(F+=`&${d}=${h}`);try{const ee=(await(await fetch(F)).json()).map(X=>({id:X.id,title:X.title.rendered}));v.value=[...v.value,...ee],p.value++}catch(D){console.error(D)}finally{j.value=!1}}function R(t){return t==="category"?"categories":t==="post_tag"?"tags":t}async function E(t){let l=[],a=1;const d=R(t);for(;a<3;)try{const L=await(await fetch(`${y.restUrl}${d}?per_page=100&page=${a}`)).json();if(L.length===0)break;const F=L.filter(D=>D.count>0);l=[...l,...F.map(D=>({value:D.id,label:D.name}))],a++}catch(h){console.error(h)}M.value=l,console.log("ðŸš€ ~ getTermsByTaxonomy ~ terms.value:",M.value)}async function N(t){const l=Z(t);try{const d=await(await fetch(`${y.restUrl}types/${l}`)).json();S.value=d.taxonomies.map(h=>({label:h,value:h}))}catch(a){console.error(a)}}return le(()=>{$({}),N(u.value)}),le(()=>{const t=new IntersectionObserver(l=>{l[0].isIntersecting&&!j.value&&$({type:u.value,perPage:10,page:p.value,taxonomy:c.value,term:x.value})});V.value&&t.observe(V.value)}),J([r,u,c,x],()=>{v.value=[],p.value=1,$({type:u.value,perPage:10,page:p.value,taxonomy:c.value,term:x.value,search:r.value})}),J(c,()=>{c.value&&(M.value=[],E(c.value))}),J(u,()=>{x.value="",c.value="",u.value&&N(u.value)}),(t,l)=>(o(),_("div",qe,[e("div",We,[e("div",Ye,[e("div",Je,[e("label",Ge,[P(pe,{label:"Search",type:"text",onInput:l[0]||(l[0]=a=>r.value=a)})])]),e("div",Ke,[P(te,{class:"tw-w-1/3",id:"post-type",options:B,label:"Post type",selectedOption:u.value,onSelectOption:l[1]||(l[1]=a=>u.value=a),disabled:u.value===""||B.length===0},null,8,["selectedOption","disabled"]),P(te,{class:"tw-w-1/3",id:"taxonomy",options:S.value,label:"Taxonomy",selectedOption:c.value,onSelectOption:l[2]||(l[2]=a=>c.value=a),disabled:u.value===""||S.value.length===0},null,8,["options","selectedOption","disabled"]),P(te,{class:"tw-w-1/3",id:"term",options:M.value,label:"Term",selectedOption:x.value,onSelectOption:l[3]||(l[3]=a=>x.value=a),disabled:c.value===""||M.value.length===0},null,8,["options","selectedOption","disabled"])])])]),e("div",Qe,[e("div",Xe,[e("ul",Ze,[e("li",null,[e("div",et,z(Q(u.value)),1),e("ul",null,[(o(!0),_(G,null,K(v.value,a=>(o(),_("li",{key:a.id,onClick:d=>b(a),class:H(["tw-pl-6 tw-pr-2 tw-py-1 tw-m-0",g(a)?"tw-text-gray-400 tw-cursor-default ":"tw-cursor-pointer tw-text-gray-700 hover:tw-bg-blue-400 hover:tw-text-white tw-font-normal"]),innerHTML:a.title},null,10,tt))),128)),e("li",{ref_key:"sentinel",ref:V,class:"sentinel"},null,512)])])])]),e("div",at,[e("ul",st,[(o(!0),_(G,null,K(i.value,a=>(o(),_("li",{key:a.id,class:"tw-px-2 tw-py-1 tw-m-0 tw-flex tw-justify-between tw-items-start hover:tw-bg-blue-400 hover:tw-text-white tw-group"},[e("div",{innerHTML:a.title},null,8,nt),e("button",{onClick:d=>f(a),class:"tw-hidden group-hover:tw-flex tw-w-5 tw-h-5 tw-justify-center tw-items-center tw-rounded-full tw-bg-gray-700 tw-text-white hover:tw-bg-red-600"},rt,8,ot)]))),128))])])])]))}}),ct=e("p",{class:"tw-text-lg"}," Search and Add WordPress posts to train this memory. ",-1),ut={class:"tw-flex tw-flex-col tw-gap-4"},dt=e("p",{class:"tw-text-lg"},"Create content from PDFs",-1),wt={class:"tw-flex tw-gap-2"},pt={class:"tw-flex tw-items-stretch tw-font-semibold"},mt=e("div",{class:"tw-bg-gray-500 tw-text-white tw-px-4 tw-py-3 tw-rounded-l-lg tw-text-sm tw-transition-all tw-duration-300 tw-shadow-button tw-no-underline tw-cursor-pointer hover:tw-bg-gray-600"}," Choose a file: ",-1),vt={class:"tw-w-96 tw-border tw-border-gray-500 tw-bg-white tw-rounded-r-lg"},ft={class:"tw-flex tw-items-center tw-h-full tw-pl-4"},yt={class:"tw-text-lg tw-font-normal"},gt={class:"tw-flex tw-items-center tw-justify-end tw-gap-4"},ht={key:0},_t={key:1},xt=W({__name:"ai-memory-train",props:{indexMemory:String},emits:["upsertedVectorSuccess"],setup(m,{emit:k}){const y=se("aiMemoryData");if(!y)throw new Error("aiMemoryData is undefined");const{restUrl:C,ajaxUrl:r,ajaxActionTokenizePosts:u,ajaxActionEmbedData:c,ajaxActionEmbeddingPercentage:x,ajaxActionTokenizingPercentage:v,ajaxUpsertVector:i,ajaxActionUploadFile:p,nonceTokenizePosts:S,nonceEmbedData:M,nonceEmbeddingPercentage:j,nonceTokenizingPercentage:V,nonceUpsertVector:B,nonceUploadFile:b,postId:f,addedPosts:g}=y,Q=m,Z=k,$=n(Array.isArray(g)?g:[]),R=n(!1),E=n(!1),N=n(0),t=n(0),l=n(""),a=n(null),d=n([]),h=n("");async function L(){if($.value.length!==0){R.value=!0,t.value=0;try{h.value="tokenizing posts...";const s=await Me(r,u,S,f,$.value);I(d,"success",s.message,0),R.value=!1}catch(s){const w=Y(s);I(d,"error",w,0),R.value=!1}}}async function F(){E.value=!0,N.value=0;try{h.value="embedding data...";const s=await Te(r,c,M,f);I(d,"success",s.message,0),E.value=!1}catch(s){const w=Y(s);I(d,"error",w,0),E.value=!1}}async function D(){try{h.value="upserting vectors to the database...";const s=await Se(r,i,B,Q.indexMemory,f);I(d,"success",s.message,0),Z("upsertedVectorSuccess","trained"),h.value="memory trained"}catch(s){const w=Y(s);I(d,"error",w,0)}}async function ne(){d.value=[],await L(),await F(),await D()}function ee(s){const w=s.target;l.value=w.value.split("\\").pop()||"",w.files&&(a.value=w.files[0])}async function X(){if(!a.value){I(d,"warning","no file selected",0);return}try{const s=await Ie(r,p,b,a.value);I(d,"success",s.message,0)}catch(s){const w=Y(s);I(d,"error",w,0)}}function ve(s){$.value=[...$.value,s]}function fe(s){$.value=$.value.filter(w=>w.id!==s.id)}function ye(s){d.value=d.value.filter(w=>w.id!==s)}return J(()=>R.value,s=>{if(!s)return;const w=setInterval(async()=>{if(t.value===100){R.value=!1,clearInterval(w);return}try{const A=await ie(r,v,V,f);t.value=parseInt(A.progress)}catch{clearInterval(w);return}},1e3)}),J(()=>E.value,s=>{if(!s)return;const w=setInterval(async()=>{if(N.value===100){E.value=!1,clearInterval(w);return}try{const A=await ie(r,x,j,f);N.value=parseInt(A.progress)}catch{clearInterval(w);return}},1e3)}),(s,w)=>(o(),T(ue,null,{default:U(()=>[P(we,{class:"tw-top-2"},{default:U(()=>[(o(!0),_(G,null,K(d.value,A=>(o(),T(de,{key:A.id,type:A.type,message:A.message,time:A.time,onClose:Pt=>ye(A.id)},null,8,["type","message","time","onClose"]))),128))]),_:1}),ct,e("div",ut,[dt,e("div",wt,[e("label",pt,[mt,e("div",vt,[e("div",ft,z(l.value),1)]),e("input",{class:"tw-hidden",id:"from_pdf",name:"file",type:"file",onChange:ee},null,32)]),P(ae,{onClick:X},{default:U(()=>[q("Upload")]),_:1})])]),P(it,{onAddPost:ve,onRemovePost:fe,selectedPostsDefault:$.value,restUrl:_e(C)},null,8,["selectedPostsDefault","restUrl"]),e("p",yt," You have selected "+z($.value.length===1?"1 post.":`${$.value.length} posts.`),1),e("div",gt,[h.value!=="memory trained"?(o(),_("p",ht," It takes some time, be patient ")):O("",!0),$.value.length!==0?(o(),_("p",_t,z(h.value),1)):O("",!0),h.value==="tokenizing posts..."?(o(),T(ce,{key:2,percent:t.value},null,8,["percent"])):O("",!0),h.value==="embedding data..."?(o(),T(ce,{key:3,percent:N.value},null,8,["percent"])):O("",!0),P(ae,{onClick:ne,disabled:$.value.length===0},{default:U(()=>[q("Start training memory")]),_:1},8,["disabled"])])]),_:1}))}}),bt={class:"tw-font-arboria"},$t=W({__name:"ai-memory",setup(m){const k=se("aiMemoryData");if(!k)throw new Error("aiMemoryData is undefined");const{indexName:y,indexStatus:C}=k,r=n(y!=="undefined"?y:""),u=n(C),c=n(!1);function x(v){setTimeout(()=>{r.value=v,u.value="connected"},3e3),setTimeout(()=>{c.value=!0},2500),setTimeout(()=>{c.value=!1},3e3)}return(v,i)=>(o(),_("div",bt,[r.value?O("",!0):(o(),T(re,{key:0,class:H(["tw-transition tw-duration-500",c.value?"tw-opacity-0":"tw-opacity-100"]),title:"Create Pinecone Index",hasAdvanced:!1},null,8,["class"])),r.value?(o(),T(re,{key:1,class:H(["tw-transition tw-duration-500",c.value?"tw-opacity-0":"tw-opacity-100"]),title:r.value,status:u.value},null,8,["class","title","status"])):O("",!0),r.value?O("",!0):(o(),T(Ne,{key:2,class:H(["tw-transition tw-duration-500",c.value?"tw-opacity-0":"tw-opacity-100"]),onCreatePineconIndexSuccess:x},null,8,["class"])),r.value?(o(),T(xt,{key:3,class:H(["tw-transition tw-duration-500",c.value?"tw-opacity-0":"tw-opacity-100"]),indexMemory:r.value,onUpsertedVectorSuccess:i[0]||(i[0]=p=>u.value=p)},null,8,["class","indexMemory"])):O("",!0)]))}});let me={};me=window.ai_memory.data;const kt=xe({setup(){$e("aiMemoryData",me)},render:()=>be($t)});kt.mount("#main_ai_memory");
